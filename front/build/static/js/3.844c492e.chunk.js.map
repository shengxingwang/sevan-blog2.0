{"version":3,"sources":["pages/shows/shows.js"],"names":["Shows","state","page","offset","reload","this","scrollEle","document","getElementById","ele","childNodes","arrH","forEach","item","i","itemH","offsetHeight","push","style","top","left","minHeight","Math","min","apply","idx","indexOf","height","getData","type","data","action","props","getCommList","event","winH","documentElement","body","scrllEle","target","scrollTop","firstChild","commData","curPage","totalPage","comm","commList","map","react__WEBPACK_IMPORTED_MODULE_5___default","a","createElement","key","className","comment","nickname","ptime","split","onScroll","scrollLoad","bind","id","Component","connect"],"mappings":"sMAMMA,6MAKFC,MAAM,CACFC,KAAK,EACLC,OAAO,MAEXC,QAAO,IACPF,KAAO,sFAOHG,KAAKD,QAAS,EACd,IAAIE,EAAYC,SAASC,eAAe,YACpCC,EAAMF,SAASC,eAAe,YAAYE,WAC1CC,EAAO,GACXF,EAAIG,QAAQ,SAACC,EAAKC,GACd,IAAIC,EAAQF,EAAKG,aACjB,GAAGF,EAAE,EACDH,EAAKM,KAAKF,EAAM,IAChBF,EAAKK,MAAMC,IAAM,OACjBN,EAAKK,MAAME,KAAQ,GAAGN,EAAG,KAAKA,EAAE,GAAK,QACnC,CACF,IAAIO,EAAYC,KAAKC,IAAIC,MAAM,KAAKb,GAChCc,EAAMd,EAAKe,QAAQL,GACvBR,EAAKK,MAAMC,IAAMR,EAAKc,GAAK,GAAI,KAC/BZ,EAAKK,MAAME,KAAQ,GAAGK,EAAK,KAAKA,EAAI,GAAK,IACzCd,EAAKc,GAAOd,EAAKc,IAAMV,EAAM,IAC7BT,EAAUY,MAAMS,OAAShB,EAAKc,GAAK,oDAK3CpB,KAAKuB,QAAQ,mCAETC,GACJ,IAAIC,EAAO,CACPC,OAAO,kBACP7B,KAAKG,KAAKH,KACVC,OAAOE,KAAKJ,MAAME,QAEtBE,KAAK2B,MAAMC,YAAYH,EAAMD,sCAEtBK,GACP,IAAIC,EAAO5B,SAAS6B,gBAAgBpB,cAAcT,SAAS8B,KAAKrB,aAC5DsB,EAAWJ,EAAMK,OACPD,EAASE,UAGZL,GAFAG,EAASG,WAAWzB,aAET,IAAIX,KAAK2B,MAAMU,SAASC,QAAQtC,KAAK2B,MAAMU,SAASE,WAAWvC,KAAKD,SACtFC,KAAKD,QAAS,EACdC,KAAKH,KAAKG,KAAK2B,MAAMU,SAASC,QAAQ,EACtCtC,KAAKuB,4CAIT,IAAIiB,EAAOxC,KAAK2B,MAAMU,SAASI,SAASC,IAAI,SAAClC,EAAMC,GAC/C,OACIkC,EAAAC,EAAAC,cAAA,OAAKC,IAAKrC,EAAGsC,UAAU,QACnBJ,EAAAC,EAAAC,cAAA,SAAIrC,EAAKwC,SACTL,EAAAC,EAAAC,cAAA,KAAGE,UAAU,QAAOJ,EAAAC,EAAAC,cAAA,QAAME,UAAU,QAAQvC,EAAKyC,SAAS,eAAKzC,EAAK0C,MAAMC,MAAM,KAAK,QAIjG,OACIR,EAAAC,EAAAC,cAAA,OAAKO,SAAUpD,KAAKqD,WAAWC,KAAKtD,MAAO+C,UAAU,2BACjDJ,EAAAC,EAAAC,cAAA,OAAKE,UAAU,YAAYQ,GAAG,YACzBf,WAxEDgB,aA+ELC,sBAAQ,SAAA7D,GAAK,MAAK,CAC7ByC,SAASzC,EAAMyC,WAChB,CACCT,iBAHW6B,CAIZ9D","file":"static/js/3.844c492e.chunk.js","sourcesContent":["import React, {Component} from 'react';\r\nimport './shows.css';\r\nimport {connect} from 'react-redux';\r\nimport propTypes from 'prop-types';\r\nimport {getCommList} from './../../store/actions/action';\r\n\r\nclass Shows extends Component{\r\n    static propTypes = {\r\n        commData:propTypes.object.isRequired,\r\n        getCommList:propTypes.func.isRequired\r\n    };\r\n    state={\r\n        page:1,\r\n        offset:30\r\n    };\r\n    reload=true;\r\n    page = 1;\r\n    // shouldComponentUpdate(nextProps, nextState){\r\n    //     // return this.props.location!==nextProps.location;\r\n    //     // console.log(this.state.page+\"----\"+nextState.page);\r\n    //     return this.page !== nextProps.commData.curPage;\r\n    // };\r\n    componentDidUpdate(){\r\n        this.reload = true;\r\n        let scrollEle = document.getElementById(\"poemCard\");\r\n        let ele = document.getElementById(\"poemCard\").childNodes;\r\n        let arrH = [];\r\n        ele.forEach((item,i) => {\r\n            let itemH = item.offsetHeight;\r\n            if(i<3){\r\n                arrH.push(itemH+20);\r\n                item.style.top = 20+\"px\";\r\n                item.style.left = (30*i+(1.5*(i+1)))+\"%\";\r\n            }else {\r\n                let minHeight = Math.min.apply(null,arrH);\r\n                let idx = arrH.indexOf(minHeight);\r\n                item.style.top =(arrH[idx]+20)+\"px\";\r\n                item.style.left = (30*idx+(1.5*(idx+1)))+\"%\";\r\n                arrH[idx] = arrH[idx]+(itemH+20);\r\n                scrollEle.style.height = arrH[idx]+\"px\";\r\n            }\r\n        });\r\n    };\r\n    componentDidMount(){\r\n        this.getData(1);\r\n    };\r\n    getData(type){\r\n        let data = {\r\n            action:'getCouldComment',\r\n            page:this.page,\r\n            offset:this.state.offset\r\n        };\r\n        this.props.getCommList(data, type);\r\n    };\r\n    scrollLoad(event){\r\n        let winH = document.documentElement.offsetHeight||document.body.offsetHeight;\r\n        let scrllEle = event.target;\r\n        let scrollH = scrllEle.scrollTop;\r\n        let conH = scrllEle.firstChild.offsetHeight;\r\n        // console.log(scrollH+\"--\"+winH+\"--\"+conH);\r\n        if(scrollH+winH>=conH-30&&this.props.commData.curPage<this.props.commData.totalPage&&this.reload){\r\n            this.reload = false;\r\n            this.page=this.props.commData.curPage+1;\r\n            this.getData();\r\n        }\r\n    };\r\n    render() {\r\n        let comm = this.props.commData.commList.map((item, i) => {\r\n            return(\r\n                <div key={i} className='item'>\r\n                    <p>{item.comment}</p>\r\n                    <p className='bomm'><span className='flag'>{item.nickname+\"——\"+item.ptime.split(\" \")[0]}</span></p>\r\n                </div>\r\n            )\r\n        });\r\n        return (\r\n            <div onScroll={this.scrollLoad.bind(this)} className='shows-box rig-container'>\r\n                <div className='poem-card' id=\"poemCard\">\r\n                    {comm}\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n}\r\n\r\nexport default connect(state => ({\r\n    commData:state.commData\r\n}),{\r\n    getCommList\r\n})(Shows)"],"sourceRoot":""}